A_Instructions = {
    SP = 0,
    LCL = 1,
    ARG = 2,
    THIS = 3,
    THAT = 4,
    SCREEN = 16384,
    KBD = 24576
}

C_instructions = {
    ['A;JGT'] = '1110110000000001',
    ['M;JGT'] = '1111110000000001',
    ['A;JGE'] = '1110110000000011',
    ['M;JGE'] = '1111110000000011',
    ['A;JLT'] = '1110110000000100',
    ['M;JLT'] = '1111110000000100',
    ['A;JEQ'] = '1110110000000010',
    ['M;JEQ'] = '1111110000000010',
    ['A;JLE'] = '1110110000000110',
    ['M;JLE'] = '1111110000000110',
    ['A;JMP'] = '1110110000000111',
    ['M;JMP'] = '1111110000000111',
    ['A;JNE'] = '1110110000000101',
    ['M;JNE'] = '1111110000000101',
    ['D+A;JGT'] = '1110000010000001',
    ['D+M;JGT'] = '1111000010000001',
    ['D+A;JGE'] = '1110000010000011',
    ['D+M;JGE'] = '1111000010000011',
    ['D+A;JLT'] = '1110000010000100',
    ['D+M;JLT'] = '1111000010000100',
    ['D+A;JEQ'] = '1110000010000010',
    ['D+M;JEQ'] = '1111000010000010',
    ['D+A;JLE'] = '1110000010000110',
    ['D+M;JLE'] = '1111000010000110',
    ['D+A;JMP'] = '1110000010000111',
    ['D+M;JMP'] = '1111000010000111',
    ['D+A;JNE'] = '1110000010000101',
    ['D+M;JNE'] = '1111000010000101',
    ['!A;JGT'] = '1110110001000001',
    ['!M;JGT'] = '1111110001000001',
    ['!A;JGE'] = '1110110001000011',
    ['!M;JGE'] = '1111110001000011',
    ['!A;JLT'] = '1110110001000100',
    ['!M;JLT'] = '1111110001000100',
    ['!A;JEQ'] = '1110110001000010',
    ['!M;JEQ'] = '1111110001000010',
    ['!A;JLE'] = '1110110001000110',
    ['!M;JLE'] = '1111110001000110',
    ['!A;JMP'] = '1110110001000111',
    ['!M;JMP'] = '1111110001000111',
    ['!A;JNE'] = '1110110001000101',
    ['!M;JNE'] = '1111110001000101',
    ['D&A;JGT'] = '1110000000000001',
    ['D&M;JGT'] = '1111000000000001',
    ['D&A;JGE'] = '1110000000000011',
    ['D&M;JGE'] = '1111000000000011',
    ['D&A;JLT'] = '1110000000000100',
    ['D&M;JLT'] = '1111000000000100',
    ['D&A;JEQ'] = '1110000000000010',
    ['D&M;JEQ'] = '1111000000000010',
    ['D&A;JLE'] = '1110000000000110',
    ['D&M;JLE'] = '1111000000000110',
    ['D&A;JMP'] = '1110000000000111',
    ['D&M;JMP'] = '1111000000000111',
    ['D&A;JNE'] = '1110000000000101',
    ['D&M;JNE'] = '1111000000000101',
    ['!D;JGT'] = '1110001101000001',
    ['!D;JGE'] = '1110001101000011',
    ['!D;JLT'] = '1110001101000100',
    ['!D;JEQ'] = '1110001101000010',
    ['!D;JLE'] = '1110001101000110',
    ['!D;JMP'] = '1110001101000111',
    ['!D;JNE'] = '1110001101000101',
    ['D;JGT'] = '1110001100000001',
    ['D;JGE'] = '1110001100000011',
    ['D;JLT'] = '1110001100000100',
    ['D;JEQ'] = '1110001100000010',
    ['D;JLE'] = '1110001100000110',
    ['D;JMP'] = '1110001100000111',
    ['D;JNE'] = '1110001100000101',
    ['D-A;JGT'] = '1110010011000001',
    ['D-M;JGT'] = '1111010011000001',
    ['D-A;JGE'] = '1110010011000011',
    ['D-M;JGE'] = '1111010011000011',
    ['D-A;JLT'] = '1110010011000100',
    ['D-M;JLT'] = '1111010011000100',
    ['D-A;JEQ'] = '1110010011000010',
    ['D-M;JEQ'] = '1111010011000010',
    ['D-A;JLE'] = '1110010011000110',
    ['D-M;JLE'] = '1111010011000110',
    ['D-A;JMP'] = '1110010011000111',
    ['D-M;JMP'] = '1111010011000111',
    ['D-A;JNE'] = '1110010011000101',
    ['D-M;JNE'] = '1111010011000101',
    ['D-1;JGT'] = '1110001110000001',
    ['D-1;JGE'] = '1110001110000011',
    ['D-1;JLT'] = '1110001110000100',
    ['D-1;JEQ'] = '1110001110000010',
    ['D-1;JLE'] = '1110001110000110',
    ['D-1;JMP'] = '1110001110000111',
    ['D-1;JNE'] = '1110001110000101',
    ['-D;JGT'] = '1110001111000001',
    ['-D;JGE'] = '1110001111000011',
    ['-D;JLT'] = '1110001111000100',
    ['-D;JEQ'] = '1110001111000010',
    ['-D;JLE'] = '1110001111000110',
    ['-D;JMP'] = '1110001111000111',
    ['-D;JNE'] = '1110001111000101',
    ['-A;JGT'] = '1110110011000001',
    ['-M;JGT'] = '1111110011000001',
    ['-A;JGE'] = '1110110011000011',
    ['-M;JGE'] = '1111110011000011',
    ['-A;JLT'] = '1110110011000100',
    ['-M;JLT'] = '1111110011000100',
    ['-A;JEQ'] = '1110110011000010',
    ['-M;JEQ'] = '1111110011000010',
    ['-A;JLE'] = '1110110011000110',
    ['-M;JLE'] = '1111110011000110',
    ['-A;JMP'] = '1110110011000111',
    ['-M;JMP'] = '1111110011000111',
    ['-A;JNE'] = '1110110011000101',
    ['-M;JNE'] = '1111110011000101',
    ['1;JGT'] = '1110111111000001',
    ['1;JGE'] = '1110111111000011',
    ['1;JLT'] = '1110111111000100',
    ['1;JEQ'] = '1110111111000010',
    ['1;JLE'] = '1110111111000110',
    ['1;JMP'] = '1110111111000111',
    ['1;JNE'] = '1110111111000101',
    ['0;JGT'] = '1110101010000001',
    ['0;JGE'] = '1110101010000011',
    ['0;JLT'] = '1110101010000100',
    ['0;JEQ'] = '1110101010000010',
    ['0;JLE'] = '1110101010000110',
    ['0;JMP'] = '1110101010000111',
    ['0;JNE'] = '1110101010000101',
    ['D|A;JGT'] = '1110010101000001',
    ['D|M;JGT'] = '1111010101000001',
    ['D|A;JGE'] = '1110010101000011',
    ['D|M;JGE'] = '1111010101000011',
    ['D|A;JLT'] = '1110010101000100',
    ['D|M;JLT'] = '1111010101000100',
    ['D|A;JEQ'] = '1110010101000010',
    ['D|M;JEQ'] = '1111010101000010',
    ['D|A;JLE'] = '1110010101000110',
    ['D|M;JLE'] = '1111010101000110',
    ['D|A;JMP'] = '1110010101000111',
    ['D|M;JMP'] = '1111010101000111',
    ['D|A;JNE'] = '1110010101000101',
    ['D|M;JNE'] = '1111010101000101',
    ['A-D;JGT'] = '1110000111000001',
    ['M-D;JGT'] = '1111000111000001',
    ['A-D;JGE'] = '1110000111000011',
    ['M-D;JGE'] = '1111000111000011',
    ['A-D;JLT'] = '1110000111000100',
    ['M-D;JLT'] = '1111000111000100',
    ['A-D;JEQ'] = '1110000111000010',
    ['M-D;JEQ'] = '1111000111000010',
    ['A-D;JLE'] = '1110000111000110',
    ['M-D;JLE'] = '1111000111000110',
    ['A-D;JMP'] = '1110000111000111',
    ['M-D;JMP'] = '1111000111000111',
    ['A-D;JNE'] = '1110000111000101',
    ['M-D;JNE'] = '1111000111000101',
    ['A+1;JGT'] = '1110110111000001',
    ['M+1;JGT'] = '1111110111000001',
    ['A+1;JGE'] = '1110110111000011',
    ['M+1;JGE'] = '1111110111000011',
    ['A+1;JLT'] = '1110110111000100',
    ['M+1;JLT'] = '1111110111000100',
    ['A+1;JEQ'] = '1110110111000010',
    ['M+1;JEQ'] = '1111110111000010',
    ['A+1;JLE'] = '1110110111000110',
    ['M+1;JLE'] = '1111110111000110',
    ['A+1;JMP'] = '1110110111000111',
    ['M+1;JMP'] = '1111110111000111',
    ['A+1;JNE'] = '1110110111000101',
    ['M+1;JNE'] = '1111110111000101',
    ['D+1;JGT'] = '1110011111000001',
    ['D+1;JGE'] = '1110011111000011',
    ['D+1;JLT'] = '1110011111000100',
    ['D+1;JEQ'] = '1110011111000010',
    ['D+1;JLE'] = '1110011111000110',
    ['D+1;JMP'] = '1110011111000111',
    ['D+1;JNE'] = '1110011111000101',
    ['-1;JGT'] = '1110111010000001',
    ['-1;JGE'] = '1110111010000011',
    ['-1;JLT'] = '1110111010000100',
    ['-1;JEQ'] = '1110111010000010',
    ['-1;JLE'] = '1110111010000110',
    ['-1;JMP'] = '1110111010000111',
    ['-1;JNE'] = '1110111010000101',
    ['A-1;JGT'] = '1110110010000001',
    ['M-1;JGT'] = '1111110010000001',
    ['A-1;JGE'] = '1110110010000011',
    ['M-1;JGE'] = '1111110010000011',
    ['A-1;JLT'] = '1110110010000100',
    ['M-1;JLT'] = '1111110010000100',
    ['A-1;JEQ'] = '1110110010000010',
    ['M-1;JEQ'] = '1111110010000010',
    ['A-1;JLE'] = '1110110010000110',
    ['M-1;JLE'] = '1111110010000110',
    ['A-1;JMP'] = '1110110010000111',
    ['M-1;JMP'] = '1111110010000111',
    ['A-1;JNE'] = '1110110010000101',
    ['M-1;JNE'] = '1111110010000101',
    ['AD=A'] = '1110110000110000',
    ['AD=M'] = '1111110000110000',
    ['AD=D+A'] = '1110000010110000',
    ['AD=D+M'] = '1111000010110000',
    ['AD=!A'] = '1110110001110000',
    ['AD=!M'] = '1111110001110000',
    ['AD=D&A'] = '1110000000110000',
    ['AD=D&M'] = '1111000000110000',
    ['AD=!D'] = '1110001101110000',
    ['AD=D'] = '1110001100110000',
    ['AD=D-A'] = '1110010011110000',
    ['AD=D-M'] = '1111010011110000',
    ['AD=D-1'] = '1110001110110000',
    ['AD=-D'] = '1110001111110000',
    ['AD=-A'] = '1110110011110000',
    ['AD=-M'] = '1111110011110000',
    ['AD=1'] = '1110111111110000',
    ['AD=0'] = '1110101010110000',
    ['AD=D|A'] = '1110010101110000',
    ['AD=D|M'] = '1111010101110000',
    ['AD=A-D'] = '1110000111110000',
    ['AD=M-D'] = '1111000111110000',
    ['AD=A+1'] = '1110110111110000',
    ['AD=M+1'] = '1111110111110000',
    ['AD=D+1'] = '1110011111110000',
    ['AD=-1'] = '1110111010110000',
    ['AD=A-1'] = '1110110010110000',
    ['AD=M-1'] = '1111110010110000',
    ['D=A'] = '1110110000010000',
    ['D=M'] = '1111110000010000',
    ['D=D+A'] = '1110000010010000',
    ['D=D+M'] = '1111000010010000',
    ['D=!A'] = '1110110001010000',
    ['D=!M'] = '1111110001010000',
    ['D=D&A'] = '1110000000010000',
    ['D=D&M'] = '1111000000010000',
    ['D=!D'] = '1110001101010000',
    ['D=D'] = '1110001100010000',
    ['D=D-A'] = '1110010011010000',
    ['D=D-M'] = '1111010011010000',
    ['D=D-1'] = '1110001110010000',
    ['D=-D'] = '1110001111010000',
    ['D=-A'] = '1110110011010000',
    ['D=-M'] = '1111110011010000',
    ['D=1'] = '1110111111010000',
    ['D=0'] = '1110101010010000',
    ['D=D|A'] = '1110010101010000',
    ['D=D|M'] = '1111010101010000',
    ['D=A-D'] = '1110000111010000',
    ['D=M-D'] = '1111000111010000',
    ['D=A+1'] = '1110110111010000',
    ['D=M+1'] = '1111110111010000',
    ['D=D+1'] = '1110011111010000',
    ['D=-1'] = '1110111010010000',
    ['D=A-1'] = '1110110010010000',
    ['D=M-1'] = '1111110010010000',
    ['DM=A'] = '1110110000011000',
    ['DM=M'] = '1111110000011000',
    ['DM=D+A'] = '1110000010011000',
    ['DM=D+M'] = '1111000010011000',
    ['DM=!A'] = '1110110001011000',
    ['DM=!M'] = '1111110001011000',
    ['DM=D&A'] = '1110000000011000',
    ['DM=D&M'] = '1111000000011000',
    ['DM=!D'] = '1110001101011000',
    ['DM=D'] = '1110001100011000',
    ['DM=D-A'] = '1110010011011000',
    ['DM=D-M'] = '1111010011011000',
    ['DM=D-1'] = '1110001110011000',
    ['DM=-D'] = '1110001111011000',
    ['DM=-A'] = '1110110011011000',
    ['DM=-M'] = '1111110011011000',
    ['DM=1'] = '1110111111011000',
    ['DM=0'] = '1110101010011000',
    ['DM=D|A'] = '1110010101011000',
    ['DM=D|M'] = '1111010101011000',
    ['DM=A-D'] = '1110000111011000',
    ['DM=M-D'] = '1111000111011000',
    ['DM=A+1'] = '1110110111011000',
    ['DM=M+1'] = '1111110111011000',
    ['DM=D+1'] = '1110011111011000',
    ['DM=-1'] = '1110111010011000',
    ['DM=A-1'] = '1110110010011000',
    ['DM=M-1'] = '1111110010011000',
    ['AM=A'] = '1110110000101000',
    ['AM=M'] = '1111110000101000',
    ['AM=D+A'] = '1110000010101000',
    ['AM=D+M'] = '1111000010101000',
    ['AM=!A'] = '1110110001101000',
    ['AM=!M'] = '1111110001101000',
    ['AM=D&A'] = '1110000000101000',
    ['AM=D&M'] = '1111000000101000',
    ['AM=!D'] = '1110001101101000',
    ['AM=D'] = '1110001100101000',
    ['AM=D-A'] = '1110010011101000',
    ['AM=D-M'] = '1111010011101000',
    ['AM=D-1'] = '1110001110101000',
    ['AM=-D'] = '1110001111101000',
    ['AM=-A'] = '1110110011101000',
    ['AM=-M'] = '1111110011101000',
    ['AM=1'] = '1110111111101000',
    ['AM=0'] = '1110101010101000',
    ['AM=D|A'] = '1110010101101000',
    ['AM=D|M'] = '1111010101101000',
    ['AM=A-D'] = '1110000111101000',
    ['AM=M-D'] = '1111000111101000',
    ['AM=A+1'] = '1110110111101000',
    ['AM=M+1'] = '1111110111101000',
    ['AM=D+1'] = '1110011111101000',
    ['AM=-1'] = '1110111010101000',
    ['AM=A-1'] = '1110110010101000',
    ['AM=M-1'] = '1111110010101000',
    ['M=A'] = '1110110000001000',
    ['M=M'] = '1111110000001000',
    ['M=D+A'] = '1110000010001000',
    ['M=D+M'] = '1111000010001000',
    ['M=!A'] = '1110110001001000',
    ['M=!M'] = '1111110001001000',
    ['M=D&A'] = '1110000000001000',
    ['M=D&M'] = '1111000000001000',
    ['M=!D'] = '1110001101001000',
    ['M=D'] = '1110001100001000',
    ['M=D-A'] = '1110010011001000',
    ['M=D-M'] = '1111010011001000',
    ['M=D-1'] = '1110001110001000',
    ['M=-D'] = '1110001111001000',
    ['M=-A'] = '1110110011001000',
    ['M=-M'] = '1111110011001000',
    ['M=1'] = '1110111111001000',
    ['M=0'] = '1110101010001000',
    ['M=D|A'] = '1110010101001000',
    ['M=D|M'] = '1111010101001000',
    ['M=A-D'] = '1110000111001000',
    ['M=M-D'] = '1111000111001000',
    ['M=A+1'] = '1110110111001000',
    ['M=M+1'] = '1111110111001000',
    ['M=D+1'] = '1110011111001000',
    ['M=-1'] = '1110111010001000',
    ['M=A-1'] = '1110110010001000',
    ['M=M-1'] = '1111110010001000',
    ['MD=A'] = '1110110000011000',
    ['MD=M'] = '1111110000011000',
    ['MD=D+A'] = '1110000010011000',
    ['MD=D+M'] = '1111000010011000',
    ['MD=!A'] = '1110110001011000',
    ['MD=!M'] = '1111110001011000',
    ['MD=D&A'] = '1110000000011000',
    ['MD=D&M'] = '1111000000011000',
    ['MD=!D'] = '1110001101011000',
    ['MD=D'] = '1110001100011000',
    ['MD=D-A'] = '1110010011011000',
    ['MD=D-M'] = '1111010011011000',
    ['MD=D-1'] = '1110001110011000',
    ['MD=-D'] = '1110001111011000',
    ['MD=-A'] = '1110110011011000',
    ['MD=-M'] = '1111110011011000',
    ['MD=1'] = '1110111111011000',
    ['MD=0'] = '1110101010011000',
    ['MD=D|A'] = '1110010101011000',
    ['MD=D|M'] = '1111010101011000',
    ['MD=A-D'] = '1110000111011000',
    ['MD=M-D'] = '1111000111011000',
    ['MD=A+1'] = '1110110111011000',
    ['MD=M+1'] = '1111110111011000',
    ['MD=D+1'] = '1110011111011000',
    ['MD=-1'] = '1110111010011000',
    ['MD=A-1'] = '1110110010011000',
    ['MD=M-1'] = '1111110010011000',
    ['ADM=A'] = '1110110000111000',
    ['ADM=M'] = '1111110000111000',
    ['ADM=D+A'] = '1110000010111000',
    ['ADM=D+M'] = '1111000010111000',
    ['ADM=!A'] = '1110110001111000',
    ['ADM=!M'] = '1111110001111000',
    ['ADM=D&A'] = '1110000000111000',
    ['ADM=D&M'] = '1111000000111000',
    ['ADM=!D'] = '1110001101111000',
    ['ADM=D'] = '1110001100111000',
    ['ADM=D-A'] = '1110010011111000',
    ['ADM=D-M'] = '1111010011111000',
    ['ADM=D-1'] = '1110001110111000',
    ['ADM=-D'] = '1110001111111000',
    ['ADM=-A'] = '1110110011111000',
    ['ADM=-M'] = '1111110011111000',
    ['ADM=1'] = '1110111111111000',
    ['ADM=0'] = '1110101010111000',
    ['ADM=D|A'] = '1110010101111000',
    ['ADM=D|M'] = '1111010101111000',
    ['ADM=A-D'] = '1110000111111000',
    ['ADM=M-D'] = '1111000111111000',
    ['ADM=A+1'] = '1110110111111000',
    ['ADM=M+1'] = '1111110111111000',
    ['ADM=D+1'] = '1110011111111000',
    ['ADM=-1'] = '1110111010111000',
    ['ADM=A-1'] = '1110110010111000',
    ['ADM=M-1'] = '1111110010111000',
    ['A=A'] = '1110110000100000',
    ['A=M'] = '1111110000100000',
    ['A=D+A'] = '1110000010100000',
    ['A=D+M'] = '1111000010100000',
    ['A=!A'] = '1110110001100000',
    ['A=!M'] = '1111110001100000',
    ['A=D&A'] = '1110000000100000',
    ['A=D&M'] = '1111000000100000',
    ['A=!D'] = '1110001101100000',
    ['A=D'] = '1110001100100000',
    ['A=D-A'] = '1110010011100000',
    ['A=D-M'] = '1111010011100000',
    ['A=D-1'] = '1110001110100000',
    ['A=-D'] = '1110001111100000',
    ['A=-A'] = '1110110011100000',
    ['A=-M'] = '1111110011100000',
    ['A=1'] = '1110111111100000',
    ['A=0'] = '1110101010100000',
    ['A=D|A'] = '1110010101100000',
    ['A=D|M'] = '1111010101100000',
    ['A=A-D'] = '1110000111100000',
    ['A=M-D'] = '1111000111100000',
    ['A=A+1'] = '1110110111100000',
    ['A=M+1'] = '1111110111100000',
    ['A=D+1'] = '1110011111100000',
    ['A=-1'] = '1110111010100000',
    ['A=A-1'] = '1110110010100000',
    ['A=M-1'] = '1111110010100000'
}
local lfs = require "lfs"
local bit = bit32 or require("bit")

-- Converts a number to a 16-bit binary string
local function To16bitbinary(number)
    local bits = ''
    for i = 15, 0, -1 do
        bits = bits .. ((bit.band(number, bit.lshift(1, i)) ~= 0) and '1' or '0')
    end
    return bits
end

-- Converts an A-instruction to a binary string
local function Convert_Ainstruction(a)
    local addr = string.sub(a, 2)
    local num = tonumber(addr)
    if num then
        return To16bitbinary(num)
    elseif addr:match('^R%d+$') then
        -- Matches register names like R0, R1, ..., R15
        -- ^R: Starts with 'R'
        -- %d+: Followed by one or more digits
        num = tonumber(string.sub(addr, 2))
        return To16bitbinary(num)
    else
        if not A_Instructions[addr] then
            V_Values = V_Values + 1
            A_Instructions[addr] = V_Values
        end
        return To16bitbinary(A_Instructions[addr])
    end
end

-- Main processing
local function process_file(input_path, output_path)
    print("Proccessing:\t" .. input_path)
    -- Change directory to the input file's directory
    lfs.chdir(input_path)

    -- Read and clean the input file
    local file = io.open(input_path, 'rb')
    local parsed = file:read('*a'):gsub("\r\n", "\n"):gsub(" ", "")
    file:close()

    -- Remove comments and empty lines
    parsed = parsed:gsub("%s*//.-\n", "\n"):gsub("\n+", "\n")
    -- %s*//.-\n: Removes single-line comments
    -- %s*: Matches any whitespace characters (0 or more)
    -- //: Matches double slashes (comment start)
    -- .-: Matches any character (0 or more) non-greedily
    -- \n: Matches a newline character

    -- \n+: Replaces multiple newlines with a single newline
    -- First pass: handle labels
    local line_number = 0
    A_Instructions = {}
    V_Values = 15
    for line in parsed:gmatch("[^\n]+") do
        -- [^\n]+: Matches any sequence of characters that are not newlines
        if line:match("^%(") then
            -- ^%(: Matches lines that start with an opening parenthesis (label definition)
            local label = line:match("^%((.+)%)$")
            -- %((.+)%): Captures the label name inside parentheses
            -- ^%(: Opening parenthesis at the start of the line
            -- (.+): Captures one or more of any character (greedy)
            -- %): Closing parenthesis
            A_Instructions[label] = line_number
        else
            line_number = line_number + 1
        end
    end

    -- Second pass: generate machine code
    local output_file = io.open(output_path, 'w')
    for line in parsed:gmatch("[^\n]+") do
        if line:match("^@") then
            -- ^@: Matches lines that start with '@' (A-instruction)
            output_file:write(Convert_Ainstruction(line) .. "\n")
        elseif not line:match("^%(") then
            -- ^%(: Excludes lines that start with '(' (labels)
            output_file:write(C_instructions[line] .. "\n")
        end
    end
    output_file:close()
end

-- Helper function to process a single file
local function process_single_file(input_file)
    local output_file = input_file:gsub("%.asm$", ".hack")
    -- Process the file
    process_file(input_file, output_file)
    print("Assembled " .. input_file .. " -> " .. output_file .. "\n")
end

-- Function to process all .asm files in a directory
local function process_directory(dir_path)
    for file in lfs.dir(dir_path) do
        if file:match("%.asm$") then
            local input_file = dir_path .. file
            process_single_file(input_file)
        end
    end
end

-- Main function to determine input type (file or directory) and process accordingly
local function main(arg)
    local path = arg[1]

    if not path then
        print("Error: No input path provided.")
        return
    end

    local attr = lfs.attributes(path)

    if not attr then
        print("Error: Path does not exist or cannot be accessed.")
        return
    end

    if attr.mode == "file" then
        process_single_file(path)
    elseif attr.mode == "directory" then
        process_directory(path)
    else
        print("Error: Unsupported path type.")
    end
end

main(arg)
